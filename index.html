<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>RIG InMoov Project: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RIG InMoov Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Dependencies">Dependencies</a></li>
<li class="level1"><a href="#Quick_Start">Quick Start</a></li>
<li class="level1"><a href="#Installation">Installation</a></li>
<li class="level1"><a href="#Build">Build System</a></li>
<li class="level1"><a href="#Arduino">Arduino Protocol</a><ul><li class="level2"><a href="#Servo">Servo Boards</a></li>
<li class="level2"><a href="#Signals">Signals</a><ul><li class="level3"><a href="#CANCEL_SIGNAL">CANCEL_SIGNAL</a></li>
<li class="level3"><a href="#WAIT_RESPONSE">WAIT_RESPONSE</a></li>
<li class="level3"><a href="#START_RESPONSE">START_RESPONSE</a></li>
<li class="level3"><a href="#END_RESPONSE">END_RESPONSE</a></li>
<li class="level3"><a href="#DUMP_SIGNAL">DUMP_SIGNAL</a></li>
</ul>
</li>
<li class="level2"><a href="#Examples">Examples</a></li>
<li class="level2"><a href="#Values">Values</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This is the official documentation for the Conestoga Robotics Innovation Group's InMoov project. It is not meant to be read linearly or all at once. Rather, readers should skim relevant pages and skip information that requires more context. More in depth information is provided for those that wish to modify the source code. Examples are provided when possible for quick reference and experimentation. Note that colored phrases are links for both html and pdf. This project has a <a href="https://git-scm.com/">git</a> repository located <a href="https://github.com/rbong/rig-inmoov">here</a>. You can download the project with the following command after installing git on your system. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git clone github.com/rbong/rig-inmoov</div></div><!-- fragment --><h1><a class="anchor" id="Dependencies"></a>
Dependencies</h1>
<p>The embedded system (servo and flex sensor glove code) currently depends on <a href="http://www.python.org">Python</a> for an example script, <a href="http://www.arduino.cc">Arduino</a> for the actual code, <a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> and <a href="https://www.tug.org/texlive/">texlive</a> (if you wish to remake the documentation), <a href="http://www.gnu.org/software/make/">Make</a> (if you wish to build the project), and <a href="http://www.ros.org/">ROS</a>/<a href="http://libserial.sourceforge.net/">LibSerial</a> for the simulation.</p>
<h1><a class="anchor" id="Quick_Start"></a>
Quick Start</h1>
<p>To quickly upload to the right hand without using <b>make</b>, do the following. Copy the <b>arduino/sketch/servo</b> folder to your <a href="https://www.arduino.cc/en/Guide/Environment#toc7">Arduino sketchbook folder</a> or any new folder. Copy <b><a class="el" href="servo__rhand_8h.html">servo/settings/servo_rhand.h</a></b> to <b>servo/settings.h</b> in the sketch directory. Open the Arduino software. <a href="https://www.arduino.cc/en/Guide/Environment#toc9">Select your board and the port</a> it is connected to. Open (<b>File&gt;Open</b>) <b><a class="el" href="servo_8ino.html">servo.ino</a></b>, and hit upload. Other Arduino files on the bot can be built in a similar way, or the <b>make</b> system command can be used. See <a class="el" href="index.html#Installation">Installation</a> for using make.</p>
<p>To transmit commands to the board, run this from the command line. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python -i example/servo_demo.py</div></div><!-- fragment --><p> You can now run commands defined in <a class="el" href="namespaceservo__demo.html">servo_demo</a>.</p>
<p>The python script needs the pyserial library. Its website is located <a href="http://pyserial.sourceforge.net/">here.</a></p>
<p>See <a class="el" href="namespaceservo__demo.html#a7855c0e41103b1ec79f74694713fb9a5">servo_demo.connect</a> to connect to the board.</p>
<p>To demo some movements, run this. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;demo ()</div></div><!-- fragment --><p> Note that some movements require input before continuing (press enter).</p>
<p>See <a class="el" href="namespaceservo__demo.html#ad6f7900ac39dba44ca3395d7e837f672">servo_demo.cmd</a> for sending any movement commands. Send strings of bytes as defined in Arduiono and <a class="el" href="index.html#Examples">Examples</a>.</p>
<p>The example script can also be used to calibrate the motors. Read the <a class="el" href="namespaceservo__demo.html">servo_demo</a> documentation for more.</p>
<p>To run the 3D simulation of the project, please refer to <a class="el" href="Simulation.html">Simulation</a>.</p>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>You can build this documentation with the command </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make documentation</div></div><!-- fragment --><p> from the root directory. To upload the documentation, run </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make gh-pages</div></div><!-- fragment --><p> and enter a commit message when prompted.</p>
<p>To upload the right hand servo code to the connected Arduino, run </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make servo.ino SETTINGS=servo_rhand ARDUINO_DO=--upload BOARD=nano PORT=&#39;/dev/ttyUSB0&#39;</div></div><!-- fragment --><p> Assuming the board is the arduino nano. For the arduino uno, BOARD would be uno and PORT would be <b>/dev/ttyACM0</b>. If multiple boards are connected, or if a board connects and disconnects quickly, the port number may increment. For example, <b>/dev/ttyUSB1</b>. If you wish to modify <b>Makefile</b>, please refer to <a href="http://www.gnu.org/software/make/manual/make.html">the make manual</a>.</p>
<p>This also requires that the latest version of <b>Arduino</b> is installed. Some systems don't have a package for the latest version, such as Ubuntu. The previous version of <b>Arduino</b> does not have command line capabilities and cannot be automated. Fortunately, the build system creates a valid arduino directory structure that we can open in the graphical <b>Arduino</b> IDE. In this case, you can run </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make servo.ino SETTINGS=servo_rhand</div></div><!-- fragment --><p> And <b>Arduino</b> will open. Open a project and navigate to <b>rig-inmoov/build/servo</b> and open the <b><a class="el" href="servo_8ino.html">servo.ino</a></b> file inside.</p>
<h1><a class="anchor" id="Build"></a>
Build System</h1>
<h2>Arduino Directory Structure</h2>
<p>The Arduino IDE abstracts many tools for working with Arduino hardware. We choose to use it because of its ease of use and cross system compatibility. However, the <b>Arduino</b> IDE only recently started coming with control tools for the command line (a process which <b>make</b> uses to compile and upload the project). Some versions of Linux do not come with the newest version of Arduino. Replicating the process performed by the <b>Arduino</b> IDE requires complex tools not appropriate for this project.</p>
<p>What follows is a description of what <b>make</b> performs to build and upload the embedded code (as defined in <b>Makefile</b>) for those not able to use the newest version of <b>Arduino</b>.</p>
<p>To share code among certain boards, general code is kept in subdirectories under <b>rig-inmoov/arduino/sketch</b>. Inside each subdirectory is an <b></b>.ino file of the same name, which is the source for the sketch. There is also a <b>settings</b> folder in which various headers are kept. These headers are to be moved to <b>settings.h</b> inside the sketch folder. For example, code to be shared among servos is kept in <b><a class="el" href="servo_8ino.html">arduino/sketch/servo/servo.ino</a></b>, the configuration for the right hand is kept in <b><a class="el" href="servo__rhand_8h.html">arduino/sketch/servo/settings/servo_rhand.h</a></b>, and you would move it to <b>arduino/sketch/servo/settings.h</b> (or another folder which you moved <b><a class="el" href="servo_8ino.html">servo.ino</a></b> into) to use it. You would then open <b><a class="el" href="servo_8ino.html">servo.ino</a></b> in the <b>Arduino</b> IDE.</p>
<p>Some sketches require shared code that use Arduino libraries, which means that they need to be contained in <b></b>.ino files. Arduino includes any <b></b>.ino files inside a sketch subdirectory. We keep such files in <b>arduino/lib</b>.</p>
<p>The reason that we do not use <b></b>.ino files for settings files is that <b></b>.ino files do not have a guaranteed order of inclusion.</p>
<h1><a class="anchor" id="Arduino"></a>
Arduino Protocol</h1>
<p>The Arduinos controlling the various parts of the bot communicate over their serial ports. All information is sent and recieved using 8 bit unsigned raw integers instead of text. This allows extremely fast and simple code, but limits programs to 255 signals, identifiers, and values.</p>
<h2><a class="anchor" id="Servo"></a>
Servo Boards</h2>
<p>The Arduino servo boards only have one function; to pass commands to their servos. </p><dl class="section user"><dt>Servo ID</dt><dd>Unless otherwise instructed, the servo boards accept two values at a time. First, it accepts a servo ID, and a value to write to the pin associated with that servo. </dd></dl>
<dl class="section user"><dt></dt><dd>Servo IDs start at 0 and should be uniquely identified on every board, allowing a maximum of 255 servos on each bot, not including signals. They should be assigned different values because if commands are routed through a central board, it allows the protocol to remain the same. If an invalid servo ID is passed to any given board, the board will still read another value from the serial port to avoid syncing issues, but it will do nothing to its servos. </dd></dl>
<dl class="section user"><dt>Servo Values</dt><dd>The value passed to the servo can be from 0-180. If it exceeds 180 and is not a valid signal, the board will change the angle to 180. On positional rotation servos, this number represents the servo's target angle. On continuous rotation servos, 90 represents stillness, 180 represents full speed in one direction, and 0 represents full speed in the other. </dd></dl>
<dl class="section user"><dt></dt><dd>Each board has callibrations for each servo that scale the angles from 0-180 to some minimum angle and some maximum angle. The host program has no need to know these values. When the board reports current values, they are scaled. </dd></dl>
<dl class="section user"><dt></dt><dd>To ensure that the board is reading the correct information (servo ID or servo position), there is a cancel signal.</dd></dl>
<h2><a class="anchor" id="Signals"></a>
Signals</h2>
<p>All boards accept some pre-defined signals that break the default flow. It can receive these signals at any time and will terminate its current servo command. In addition, the board may print some signals to output. Both kinds of signals, incoming and outgoing, are assigned starting from 255 and going down. In the arduino code, incoming signals are denoted by <b>*_SIGNAL</b>, and the outgoing signals are denoted by <b>*_RESPONSE</b>. We will use this convention.</p>
<h3><a class="anchor" id="CANCEL_SIGNAL"></a>
CANCEL_SIGNAL</h3>
<p>This signal exists to cancel all pending input and syncronize the host and master. If a host connects to an Arduino and does not know its current state, it can send this signal and know that the board is waiting on a servo ID.</p>
<h3><a class="anchor" id="WAIT_RESPONSE"></a>
WAIT_RESPONSE</h3>
<p>This response indicates that the board has no bytes left to read and is ready for input. A host does not need to wait for this response, but it may want to if it is experiencing difficulties or the board may have crashed.</p>
<h3><a class="anchor" id="START_RESPONSE"></a>
START_RESPONSE</h3>
<h3><a class="anchor" id="END_RESPONSE"></a>
END_RESPONSE</h3>
<p>These responses mark the beginning and end of a reply to some signal.</p>
<h3><a class="anchor" id="DUMP_SIGNAL"></a>
DUMP_SIGNAL</h3>
<p>This signal makes the board return various information about itself and its servos. As of writing, it returns <b>START_RESPONSE</b>, an ID, its number of servos, the IDs of each servo followed by the value last sent to that servo, and <b>END_RESPONSE</b>. If a serial connection has access to other boards and is able to send them commands, it may send more servo IDs and servo positions before <b>END_RESPONSE</b>. Board IDs start from 181 and go up. It is recommended that if we build more modular bots such as this one in the future using the same protocol, they recieve unique board identifiers. The response is likely to change in the near future as we add sensors and other types of devices. Be sure to regularly check this document.</p>
<h2><a class="anchor" id="Examples"></a>
Examples</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CANCEL_SIGNAL 0 180 1 135 2 90</div></div><!-- fragment --><p> This would send the servo with ID 0 a value of 180, servo 1 135, and servo 2 90. The board would then respond with <b>WAIT_RESPONSE</b>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CANCEL_SIGNAL 0 180 1 135 22 CANCEL_SIGNAL 4 45</div></div><!-- fragment --><p> This would send the servo with ID 0 a value of 180, servo 1 135, begin to read a command for servo 22 but cancel, then send 45 to servo 4. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CANCEL_SIGNAL 0 0 1 45 2 90 3 135 4 180 DUMP_SIGNAL</div></div><!-- fragment --><p> On a board with ID <b>BOARD_ID</b> and 5 servos identified as 0-4, this would return the response </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;START_RESPONSE BOARD_ID 4 0 0 1 45 2 90 3 135 4 180 END_RESPONSE WAIT_RESPONSE</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CANCEL_SIGNAL 0 0 0 45 0 90 0 135 0 180</div></div><!-- fragment --><p> If this stream of bytes were sent instantly, it would essentially move servo 0 directly to 180 degrees (if it was a positional servo) because of the speed of the commands. However, if we inserted a slight delay, we could slowly move the servo from its starting position to its ending position. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CANCEL_SIGNAL 0 0 1 0 0 45 1 45 0 90 1 90 0 135 1 135 0 180 1 180</div></div><!-- fragment --><p> This would move servo 0 and servo 1 from their start to end positions. If we were to send these bytes immediately, they would essentially both move instantaneously to 180 degrees (if they were positional servos). However, if we were to insert a delay, they would both appear to move together slowly to their end location despite the delay between commands. Putting this functionality on the Arduino boards themselves would cause the boards to lock and use up resources, but formulating commands like this allows computation to occur on other systems.</p>
<h2><a class="anchor" id="Values"></a>
Values</h2>
<h3>Board IDs</h3>
<table class="doxtable">
<tr>
<td>Right hand servo board </td><td>181  </td></tr>
<tr>
<td>Right hand flex sensor board </td><td>182  </td></tr>
</table>
<h3>Servo IDs</h3>
<table class="doxtable">
<tr>
<td>Right hand wrist </td><td>0  </td></tr>
<tr>
<td>Right hand thumb </td><td>1  </td></tr>
<tr>
<td>Right hand index finger </td><td>2  </td></tr>
<tr>
<td>Right hand middle finger </td><td>3  </td></tr>
<tr>
<td>Right hand ring finger </td><td>4  </td></tr>
<tr>
<td>Right hand pinky finger </td><td>5  </td></tr>
</table>
<h3>Signals</h3>
<table class="doxtable">
<tr>
<td><a class="el" href="index.html#CANCEL_SIGNAL">CANCEL_SIGNAL</a> </td><td>255  </td></tr>
<tr>
<td><a class="el" href="index.html#WAIT_RESPONSE">WAIT_RESPONSE</a> </td><td>254  </td></tr>
<tr>
<td><a class="el" href="index.html#DUMP_SIGNAL">DUMP_SIGNAL</a> </td><td>253  </td></tr>
<tr>
<td><a class="el" href="index.html#START_RESPONSE">START_RESPONSE</a> </td><td>252  </td></tr>
<tr>
<td><a class="el" href="index.html#END_RESPONSE">END_RESPONSE</a> </td><td>251  </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 19 2016 08:33:06 for RIG InMoov Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
